##############################################################################
#
#    Copyright (c) 2005 - 2016 by Vivante Corp.  All rights reserved.
#
#    The material in this file is confidential and contains trade secrets
#    of Vivante Corporation. This is proprietary information owned by
#    Vivante Corporation. No part of this work may be disclosed,
#    reproduced, copied, transmitted, or used in any way for any purpose,
#    without the express written permission of Vivante Corporation.
#
##############################################################################


#
# Linux build file for libwayland-viv library.
#

################################################################################
# Include common definitions.
include ../../makefile.linux.def

################################################################################
# Define shared library output name.
ifeq ($(gcdSTATIC_LINK), 1)
STATIC = 1
else
DYNAMIC = 1
endif

ifeq ($(STATIC), 1)
    TARGET_NAME = libwayland-viv.a
else
    TARGET_NAME = libwayland-viv.so.0.0.0
    TARGET_SONAME = libwayland-viv.so.0
    TARGET_SO = libwayland-viv.so
endif

TARGET_OUTPUT = $(OBJ_DIR)/$(TARGET_NAME)

################################################################################
# Add extra flags for object files.

ifneq ($(USE_ARMCC), 1)
  CFLAGS += -fPIC
#  ifeq (,$(EGL_APPENDIX))
#    LFLAGS += -Wl,--version-script=libEGL.map
#  endif
endif

################################################################################
# Supply necessary libraries.

# Specify Vivante library paths.
ifeq ($(EGL_API_WL), 1)
CFLAGS += -I$(SDK_DIR)/include/HAL
CFLAGS += -I$(WAYLAND_DIR)/include
CFLAGS += -I$(WAYLAND_DIR)/include/wayland-viv
endif


# Specify dependent libraries.
LIBS += -L $(SDK_DIR)/drivers -L $(AQROOT)/hal/user/$(OBJ_DIR) -l GAL

ifeq ($(EGL_API_WL), 1)
LIBS += -L$(WAYLAND_DIR)/lib -l wayland-server -l wayland-client -l gc_wayland_protocol
endif

################################################################################
# Describe object files.

OBJECTS = $(OBJ_DIR)/gc_wayland_protocol.o \
          $(OBJ_DIR)/wayland-viv-protocol.o

################################################################################
# Installation directory.

INSTALL_DIR = $(SDK_DIR)/drivers

################################################################################
# Include common makefile.

include $(AQROOT)/common.target

################################################################################
# Extra installation.

install: $(TARGET_OUTPUT) extra_install

.PHONY: extra_install
extra_install: $(TARGET_OUTPUT)

ifneq ($(TARGET_SO),)
	@ln -sf libwayland-viv.so.0.0.0 $(SDK_DIR)/drivers/libwayland-viv.so.0 || cp -f $(TARGET_OUTPUT) $(SDK_DIR)/drivers/libwayland-viv.so.0
	@ln -sf libwayland-viv.so.0 $(SDK_DIR)/drivers/libwayland-viv.so || cp -f $(TARGET_OUTPUT) $(SDK_DIR)/drivers/libwayland-viv.so
endif
